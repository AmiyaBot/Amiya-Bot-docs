import{_ as a,o as n,c as l,S as o}from"./chunks/framework.e7d5bd7a.js";const i=JSON.parse('{"title":"撤回消息","description":"","frontmatter":{},"headers":[],"relativePath":"develop/basic/recallMessage.md","filePath":"develop/basic/recallMessage.md","lastUpdated":1762506263000}'),p={name:"develop/basic/recallMessage.md"};function t(e,s,c,r,y,D){return n(),l("div",null,[...s[0]||(s[0]=[o(`<h1 id="撤回消息" tabindex="-1">撤回消息 <a class="header-anchor" href="#撤回消息" aria-label="Permalink to &quot;撤回消息&quot;">​</a></h1><p>撤回一条消息。</p><h2 id="在-message-对象中撤回" tabindex="-1">在 Message 对象中撤回 <a class="header-anchor" href="#在-message-对象中撤回" aria-label="Permalink to &quot;在 Message 对象中撤回&quot;">​</a></h2><p>使用 Message 对象的 <code>recall</code> 方法，撤回当前消息。</p><p><strong>Message.recall()</strong></p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span></span></code></pre></div><p>你可以在任何能获取到 Message 对象的地方使用 <code>recall</code> 方法。比如在连续对话或异常监听里。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># 等待事件返回的也是 Message 对象</span></span>
<span class="line"><span style="color:#BABED8;">    reply </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Chain</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> reply</span><span style="color:#89DDFF;">:</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> reply</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span></span></code></pre></div><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_exception</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">err</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Exception</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">            </span><span style="color:#BABED8;font-style:italic;">instance</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> BotAdapterProtocol</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">            </span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Union</span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Message</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> Event</span><span style="color:#89DDFF;">]):</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">is</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">:</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span></span></code></pre></div><h2 id="手动撤回" tabindex="-1">手动撤回 <a class="header-anchor" href="#手动撤回" aria-label="Permalink to &quot;手动撤回&quot;">​</a></h2><p>使用适配器实例的 <code>recall_message</code> 方法</p><p><strong>AmiyaBot.instance.recall_message()</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>释义</th><th>默认值</th></tr></thead><tbody><tr><td>message_id</td><td>str</td><td>消息ID（通常可以在 Message.message_id 获取到）</td><td></td></tr><tr><td>data</td><td>Message</td><td>Message 对象</td><td>None</td></tr></tbody></table><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> bot</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">message_id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">......</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">target_id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">......</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h2 id="撤回-bot-发送的消息" tabindex="-1">撤回 Bot 发送的消息 <a class="header-anchor" href="#撤回-bot-发送的消息" aria-label="Permalink to &quot;撤回 Bot 发送的消息&quot;">​</a></h2><p>如果是通过在消息响应器里面返回 <code>Chain</code> 对象或等待函数 <code>Message.wait()</code> 发送的消息，<strong>是无法撤回的</strong>，但后者可以通过另外的方法达到撤回效果。</p><table><thead><tr><th>发送消息的方法</th><th>是否可撤回</th></tr></thead><tbody><tr><td>Message.send()</td><td>✅ 可以撤回</td></tr><tr><td>Message.wait()</td><td>❌ 无法撤回</td></tr><tr><td>Message.wait_channel()</td><td>❌ 无法撤回</td></tr><tr><td>return Chain()</td><td>❌ 无法撤回</td></tr></tbody></table><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    chain </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Chain</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;hello, </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">nickname</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    callback </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chain</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># ✅ 可以撤回</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 使用回调对象撤回</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    wait </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chain</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># ❌ 无法撤回</span></span>
<span class="line"><span style="color:#BABED8;">    event </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wait_channel</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chain</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># ❌ 无法撤回</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> chain  </span><span style="color:#676E95;font-style:italic;"># ❌ 无法撤回</span></span></code></pre></div><p><strong>Message.send()</strong> 方法返回一个 <code>MessageCallback</code> 对象或其组成的列表（语音或频道多图消息会产生分开发送的结果）。如果消息没有发送成功则返回 <code>None</code>。</p><p>调用 <code>MessageCallback.recall()</code> 即可撤回发送的消息。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    callback </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">:</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 或</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># for item in callback:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;">#     await item.recall()</span></span></code></pre></div><h3 id="撤回等待的消息" tabindex="-1">撤回等待的消息 <a class="header-anchor" href="#撤回等待的消息" aria-label="Permalink to &quot;撤回等待的消息&quot;">​</a></h3><p><strong>Message.wait()</strong> 没有返回执行 <code>send</code> 时获得的 <code>MessageCallback</code>，因此你无法在使用该方法发送消息的情况下撤回，但你可以配合 <code>send</code> 达到这个效果。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    callback </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Chain</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello, what</span><span style="color:#BABED8;">\\&#39;</span><span style="color:#C3E88D;">s your name?</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># 使用 send 方法代替 wait 发送消息</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    wait </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># 只等待，不发送消息</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> callback </span><span style="color:#89DDFF;">and</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">not</span><span style="color:#BABED8;"> wait</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    ...</span></span></code></pre></div><h3 id="撤回合并转发的消息" tabindex="-1">撤回合并转发的消息 <a class="header-anchor" href="#撤回合并转发的消息" aria-label="Permalink to &quot;撤回合并转发的消息&quot;">​</a></h3><p><a href="/develop/basic/chainBuild/forward.html#发送-撤回">撤回合并转发</a></p>`,26)])])}const B=a(p,[["render",t]]);export{i as __pageData,B as default};
