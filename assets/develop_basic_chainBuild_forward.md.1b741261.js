import{_ as a,o as n,c as l,S as o}from"./chunks/framework.e7d5bd7a.js";const i=JSON.parse('{"title":"合并转发消息 Beta","description":"","frontmatter":{},"headers":[],"relativePath":"develop/basic/chainBuild/forward.md","filePath":"develop/basic/chainBuild/forward.md","lastUpdated":1762506263000}'),p={name:"develop/basic/chainBuild/forward.md"};function t(e,s,c,r,F,y){return n(),l("div",null,[...s[0]||(s[0]=[o(`<h1 id="合并转发消息-beta" tabindex="-1">合并转发消息 <span class="beta-tag">Beta</span> <a class="header-anchor" href="#合并转发消息-beta" aria-label="Permalink to &quot;合并转发消息 &lt;span class=&quot;beta-tag&quot;&gt;Beta&lt;/span&gt;&quot;">​</a></h1><p>合并转发消息不是 Chain 对象的方法，需要使用适配器提供的工具类构建。</p><div class="danger custom-block"><p class="custom-block-title">注意<br></p><p>QQ 频道机器人暂时不支持发送合并转发消息，目前仅支持 <code>mirai-api-http</code> 和 <code>cq-http</code>。</p></div><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">adapters</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">mirai </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> MiraiForwardMessage</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># from amiyabot.adapters.cqhttp import CQHTTPForwardMessage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    forward </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">MiraiForwardMessage</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># forward = CQHTTPForwardMessage(data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    chain </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Chain</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;hello, </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">nickname</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chain</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">user_id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">nickname</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">()</span></span></code></pre></div><h2 id="添加自定义消息" tabindex="-1">添加自定义消息 <a class="header-anchor" href="#添加自定义消息" aria-label="Permalink to &quot;添加自定义消息&quot;">​</a></h2><p><strong>add_message</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>释义</th><th>默认值</th></tr></thead><tbody><tr><td>chain</td><td>Chain, list</td><td>Chain 对象，可为<a href="/develop/basic/sendMessage.html#空-chain">空 Chain</a></td><td></td></tr><tr><td>user_id</td><td>int</td><td>用户 ID</td><td></td></tr><tr><td>nickname</td><td>str</td><td>用户昵称（可自定义）</td><td></td></tr><tr><td>time</td><td>int</td><td>发送时间</td><td>0</td></tr></tbody></table><ul><li><code>user_id</code> 为实际 QQ 用户的 QQ 号，可以是任意人，在合并消息内显示其头像。</li><li><code>nickname</code> 为自定义的昵称。</li></ul><p>如果 <code>chain</code> 参数传入了空 Chain，则 <code>user_id</code> 和 <code>nickname</code> 为必须参数。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Chain</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Chain</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">user_id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">nickname</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h2 id="添加指定-id-的消息" tabindex="-1">添加指定 ID 的消息 <a class="header-anchor" href="#添加指定-id-的消息" aria-label="Permalink to &quot;添加指定 ID 的消息&quot;">​</a></h2><p><strong>add_message_by_id</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>释义</th><th>默认值</th></tr></thead><tbody><tr><td>message_id</td><td>int</td><td>消息 ID</td><td></td></tr></tbody></table><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message_by_id</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5128</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h2 id="添加嵌套的合并转发消息" tabindex="-1">添加嵌套的合并转发消息 <a class="header-anchor" href="#添加嵌套的合并转发消息" aria-label="Permalink to &quot;添加嵌套的合并转发消息&quot;">​</a></h2><p>为 <code>add_message</code> 的 <code>chain</code> 参数传入 ForwardMessage 类的 <code>node</code> 属性，即可完成合并消息嵌套。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">bot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on_message</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">keywords</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">_</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Message</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    forward </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">MiraiForwardMessage</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#BABED8;">    forward2 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">MiraiForwardMessage</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_message</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">forward</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">node</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">user_id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">nickname</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">()</span></span></code></pre></div><h2 id="发送-撤回" tabindex="-1">发送 &amp; 撤回 <a class="header-anchor" href="#发送-撤回" aria-label="Permalink to &quot;发送 &amp; 撤回&quot;">​</a></h2><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">callback </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> forward</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># 发送</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> callback</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recall</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># 撤回</span></span></code></pre></div>`,19)])])}const d=a(p,[["render",t]]);export{i as __pageData,d as default};
