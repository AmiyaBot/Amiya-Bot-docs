import{_ as a,o as n,c as l,S as o}from"./chunks/framework.e7d5bd7a.js";const i=JSON.parse('{"title":"QQ 频道机器人","description":"","frontmatter":{},"headers":[],"relativePath":"develop/adapters/qqChannel.md","filePath":"develop/adapters/qqChannel.md","lastUpdated":1762506263000}'),p={name:"develop/adapters/qqChannel.md"};function t(e,s,c,r,F,y){return n(),l("div",null,[...s[0]||(s[0]=[o(`<h1 id="qq-频道机器人" tabindex="-1">QQ 频道机器人 <a class="header-anchor" href="#qq-频道机器人" aria-label="Permalink to &quot;QQ 频道机器人&quot;">​</a></h1><p>按照 <a href="/develop/basic/">基础指南</a> 创建的机器人即为 QQ 频道机器人，无需额外的适配器。</p><h2 id="事件分片" tabindex="-1">事件分片 <a class="header-anchor" href="#事件分片" aria-label="Permalink to &quot;事件分片&quot;">​</a></h2><p>考虑到开发者事件接收时可以实现负载均衡，QQ 提供了分片逻辑，事件通知会落在不同的分片上，可参考官方文档 <a href="https://bot.q.qq.com/wiki/develop/api-v2/dev-prepare/interface-framework/event-emit.html#%E5%88%86%E7%89%87%E8%BF%9E%E6%8E%A5loadbalance" target="_blank" rel="noreferrer">分片连接LoadBalance</a> 了解分片机制。</p><p>创建分片连接需要使用分片适配器 <code>qq_guild_shards</code></p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">adapters</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">tencent</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">qqGuild </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> qq_guild_shards</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">bot1 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">AmiyaBot</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">appid</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">adapter</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">qq_guild_shards</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#BABED8;">bot2 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">AmiyaBot</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">appid</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">adapter</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">qq_guild_shards</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">))</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">注意<br></p><p>每个分片的启动应当<strong>按顺序缓慢进行</strong>，切勿同时启动，以免 gateway 返回的信息一致造成连接失败。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 仅作示意，实际上每个分片应当是独立的服务。</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#BABED8;">    asyncio</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create_task</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">bot1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#BABED8;">    time</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    asyncio</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create_task</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">bot2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">())</span></span></code></pre></div></div><p><code>qq_guild_shards</code> 参数</p><table><thead><tr><th>参数名</th><th>类型</th><th>释义</th><th>默认值</th></tr></thead><tbody><tr><td>shard_index</td><td>int</td><td>分片下标，从 0 开始</td><td></td></tr><tr><td>shards</td><td>int</td><td>分片总数</td><td></td></tr></tbody></table><h2 id="沙箱环境" tabindex="-1">沙箱环境 <a class="header-anchor" href="#沙箱环境" aria-label="Permalink to &quot;沙箱环境&quot;">​</a></h2><p>使用 <code>QQGuildSandboxBotInstance</code> 适配器将 API 调用更改为沙箱环境。沙箱环境只会收到测试频道的事件，且调用 openapi 仅能操作测试频道。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">adapters</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">tencent</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">qqGuild </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> QQGuildSandboxBotInstance</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">bot </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">AmiyaBot</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">adapter</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">QQGuildSandboxBotInstance</span><span style="color:#89DDFF;">)</span></span></code></pre></div>`,12)])])}const d=a(p,[["render",t]]);export{i as __pageData,d as default};
